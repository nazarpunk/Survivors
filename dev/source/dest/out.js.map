{"version":3,"sources":["out.js"],"names":["$wrap","$","module","window","_g","flush","this","game","canvas","call","clearRect","size","width","height","dispatch","act","block","name","trim","value","replace","image","ctx","drawImage","img","action","$content","dialogs","obj","that","show","hide","dialog","empty","each","k","v","appendTo","html","on","console","log","label","humans","humanImages","h","split","_gets","arr","o","inArray","draw","tl","tc","tr","bl","bc","br","redraw","wc","hc","t","l","wi","b","pl","e","str","a","n","p","bt","et","sun","left","center","right","top","bottom","join","apply","_zeros","number","toString","length","Array","test","_draw","_anim","imgs","f","shift","undefined","setTimeout","screens","landing","weekLater","shuttle","prologue_start","prologue_anim","i","push","day01_dawn","_push","active","isActive","_screen","alert","names","$text","$nameWrap","$name","state","m","match","isName","text","actions","actionID","labels","images","blocks","dialogID","instanceID","isDev","$log","$dev","$btnStart","isBlock","instance","id","attr","prependTo","c","document","getElementById","getContext","time","set","indexOf","reset","main","modules","removeClass","story","_log","prepend","stringID","$msg","reModule","RegExp","isComment","isDialog","d","re","string","actionNext","Number","isInteger","parseFloat","css","effect","direction","distance","times","removeAttr","val","response","warn","preload","mouseInterval","mouseTimeout","$message","$btn","target","closest","$btns","find","prop","get","data","trigger","animate","scrollTop","keydown","keyCode","setInterval","clearTimeout","clearInterval","File","FileReader","FileList","Blob","input","files","file","fr","onload","result","readAsText","$imageLoading","imagesLoaded","done","$images","loaded","count","children","Image","src","domain","Date","getTime","fail","location","reload","progress","parseInt","imageCount","progressedCount","isLoaded"],"mappings":"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","file":"out.js","sourcesContent":["!function () {\n    'use strict';\n    /* vars */\n    var $wrap = $('#game-bg');\n\n    /* func */\n    var module = 'bg';\n    window._g.module(module, {\n\tflush: function () {\n\t    var ctx = this.game.canvas.call(this, $wrap);\n\t    ctx.clearRect(0, 0, this.game.size().width, this.game.size().height);\n\t},\n\n\tdispatch: function (act) {\n\n\t    /* block : true */\n\t    this.game.block.call(this, true, module);\n\n\t    /* name */\n\t    var name = $.trim(act.value.replace(/^[a-z]+/i, ''));\n\t    name = 'bg$' + name.replace(/\\//g, '$');\n\n\t    /* check image */\n\t    var image = this.game.image(name);\n\t    if (image === false) {\n\t\treturn 'wrong image name';\n\t    }\n\n\t    /* canvas */\n\t    var ctx = this.game.canvas.call(this, $wrap);\n\n\t    this.module(module).flush.call(this);\n\t    ctx.drawImage(image.img, 0, 0);\n\n\t    /* block : false */\n\t    this.game.block.call(this, false, module);\n\n\t    /* action */\n\t    this.game.action.call(this, true);\n\n\t    /* return */\n\t    return true;\n\t}\n    });\n}();\n!function () {\n    'use strict';\n\n    var $wrap = $('#game-dialog-wrap');\n    var $content = $('#game-dialog-content');\n    var dialogs = {};\n\n    /* func */\n    var module = 'dialog';\n    window._g.module(module, {\n\tdialogs: function (obj) {\n\t    dialogs = obj;\n\t},\n\n\tdispatch: function (act) {\n\t    var that = this;\n\n\t    /* block : true */\n\t    this.game.block.call(this, true, module);\n\n\t    $wrap.show();\n\n\t    /* text - hide */\n\t    this.module('text').hide.call(this, true);\n\n\t    var dialog = dialogs[act.value];\n\n\t    $content.empty();\n\n\t    $.each(dialog, function (k, v) {\n\t\t$('<div>')\n\t\t\t.appendTo($content)\n\t\t\t.html('<span>' + v.name + '</span>')\n\t\t\t.on('click', function () {\n\t\t\t    $wrap.hide();\n\n\t\t\t    console.log(v.label);\n\n\t\t\t    /* block : false */\n\t\t\t    that.game.block.call(that, false, module);\n\n\t\t\t    /* label */\n\t\t\t    that.game.label.call(that, v.label);\n\n\t\t\t    return false;\n\t\t\t});\n\t    });\n\n\t    /* return */\n\t    return true;\n\t}\n    });\n}();\n!function () {\n    'use strict';\n    /* vars */\n    var that = window._g;\n    var $wrap = $('#game-human-wrap');\n\n    var _remove = function (arr) {\n\tvar what, a = arguments, L = a.length, ax;\n\twhile (L > 1 && arr.length) {\n\t    what = a[--L];\n\t    while ((ax = arr.indexOf(what)) !== -1) {\n\t\tarr.splice(ax, 1);\n\t    }\n\t}\n\treturn arr;\n    };\n\n    var _valid = function _valid(obj) {\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tfor (var i = 0; i < args.length; i++) {\n\t    if (!obj || !obj.hasOwnProperty(args[i])) {\n\t\treturn false;\n\t    }\n\t    obj = obj[args[i]];\n\t}\n\treturn true;\n    };\n\n\n    //var ary = ['three', 'seven', 'eleven'];\n    //removeA(ary, 'seven');\n\n    var humans = {};\n\n    $.each(that.humanImages, function (k, v) {\n\tvar h = v.split('_');\n\n\t/* name */\n\tif (typeof humans[h[0]] === 'undefined') {\n\t    humans[h[0]] = {};\n\t}\n\n\t/* pose */\n\tif (typeof humans[h[0]][h[1]] === 'undefined') {\n\t    humans[h[0]][h[1]] = {};\n\t}\n\n\t/* emotion */\n\tif (h[2] === 'emotion') {\n\t    if (typeof humans[h[0]][h[1]]['emotion'] === 'undefined') {\n\t\thumans[h[0]][h[1]]['emotion'] = {};\n\t    }\n\t    if (typeof humans[h[0]][h[1]]['emotion'][h[3]] === 'undefined') {\n\t\thumans[h[0]][h[1]]['emotion'][h[3]] = {};\n\t    }\n\t    humans[h[0]][h[1]]['emotion'][h[3]][h[4]] = true;\n\t} else {\n\t    /* body */\n\t    if (typeof humans[h[0]][h[1]]['body'] === 'undefined') {\n\t\thumans[h[0]][h[1]]['body'] = {};\n\t    }\n\t    if (typeof humans[h[0]][h[1]]['body'][h[2]] === 'undefined') {\n\t\thumans[h[0]][h[1]]['body'][h[2]] = {};\n\t    }\n\t    humans[h[0]][h[1]]['body'][h[2]][h[3]] = true;\n\t}\n\n    });\n\n    var _gets = function (obj, arr) {\n\tvar o = false;\n\t$.each(obj, function (k, v) {\n\t    if ($.inArray(k, arr) >= 0) {\n\t\to = k;\n\t\treturn false;\n\t    }\n\t});\n\treturn o;\n    };\n\n    var _get = function (arr) {\n\tvar o = {\n\t    a: 'error',\n\t    n: false,\n\t    p: false,\n\t    b: false,\n\t    bt: false,\n\t    e: false,\n\t    et: false,\n\t    img: {\n\t\tb: false,\n\t\te: false\n\t    },\n\t    pl: {\n\t\th: false,\n\t\tv: false\n\t    }\n\t};\n\n\t/* hide */\n\tif ($.inArray('hide', arr) >= 0) {\n\t    o.a = 'hide';\n\t}\n\n\t/* human */\n\to.n = _gets(humans, arr);\n\tif (o.n === false) {\n\t    return o;\n\t}\n\n\t/* pose */\n\to.p = _gets(humans[o.n], arr);\n\tif (o.p === false) {\n\t    return o;\n\t}\n\n\t/* body */\n\tif (typeof humans[o.n][o.p]['body'] === 'undefined') {\n\t    return o;\n\t}\n\to.b = _gets(humans[o.n][o.p]['body'], arr);\n\tif (o.b === false) {\n\t    return o;\n\t}\n\n\t/* body time */\n\to.bt = _gets(humans[o.n][o.p]['body'][o.b], [that.game.sun()]);\n\tif (o.bt === false) {\n\t    return o;\n\t}\n\n\t/* emotion */\n\tif (typeof humans[o.n][o.p]['emotion'] === 'undefined') {\n\t    return o;\n\t}\n\to.e = _gets(humans[o.n][o.p]['emotion'], arr);\n\tif (o.e === false) {\n\t    return o;\n\t}\n\n\t/* emotion time */\n\to.et = _gets(humans[o.n][o.p]['emotion'][o.e], [that.game.sun()]);\n\tif (o.et === false) {\n\t    return o;\n\t}\n\n\t/* placement h */\n\to.pl.h = _gets({left: true, center: true, right: true}, arr);\n\tif (o.pl.h === false) {\n\t    o.pl.h = 'center';\n\t}\n\n\to.pl.v = _gets({top: true, bottom: true}, arr);\n\tif (o.pl.v === false) {\n\t    o.pl.v = 'bottom';\n\t}\n\n\to.img.b = 'human$' + [o.n, o.p, o.b, o.bt].join('_');\n\to.img.e = 'human$' + [o.n, o.p, 'emotion', o.e, o.et].join('_');\n\n\to.a = 'show';\n\treturn o;\n    };\n\n    var draw = {\n\ttl: null,\n\ttc: null,\n\ttr: null,\n\tbl: null,\n\tbc: null,\n\tbr: null\n    };\n\n    /* module */\n    var module = 'human';\n    that.module(module, {\n\tflush: function () {\n\t    $.each(draw, function (k, v) {\n\t\tdraw[k] = null;\n\t    });\n\n\t    var ctx = this.game.canvas.call(this, $wrap);\n\t    ctx.clearRect(0, 0, this.game.size().width, this.game.size().height);\n\t},\n\n\tredraw: function () {\n\n\t    var ctx = this.game.canvas.call(this, $wrap);\n\t    var wc = this.game.size().width;\n\t    var hc = this.game.size().height;\n\t    ctx.clearRect(0, 0, wc, hc);\n\t    var diff = 100;\n\n\t    var img = this.game.image;\n\n\t    /* draw */\n\t    $.each(draw, function (k, h) {\n\t\tif (h === null) {\n\t\t    return true;\n\t\t}\n\n\t\tvar t = 0;\n\t\tvar l = 0;\n\t\tvar wi = img(h.img.b).width;\n\t\tvar hi = img(h.img.b).height;\n\n\t\tif (h.pl.v === 'bottom') {\n\t\t    t += diff;\n\t\t}\n\n\t\tif (h.pl.h === 'center') {\n\t\t    l = (wc / 2) - (wi / 2);\n\t\t} else if (h.pl.h === 'right') {\n\t\t    l = wc - wi;\n\t\t}\n\n\t\tctx.drawImage(img(h.img.b).img, l, t);\n\t\tctx.drawImage(img(h.img.e).img, l, t);\n\t    });\n\t},\n\n\tdispatch: function (act) {\n\t    /* block : true */\n\t    this.game.block.call(this, false, module);\n\n\t    /* prepare */\n\t    var str = act.value.replace(/^human\\s+/, '');\n\t    str = $.trim(str.replace(/ {1,}/g, \" \"));\n\t    var o = _get(str.split(' '));\n\n\t    if (o.a === 'error') {\n\t\treturn 'human error';\n\t    }\n\n\t    /* show */\n\t    if (o.a === 'show') {\n\t\tdraw[o.pl.v[0] + o.pl.h[0]] = o;\n\n\t\tthis['_' + module].redraw.apply(this);\n\t    }\n\n\t    /* hide */\n\t    if (o.a === 'hide') {\n\t\tif (o.n === false) {\n\t\t    $.each(draw, function (k, v) {\n\t\t\tdraw[k] = null;\n\t\t    });\n\t\t} else {\n\t\t    $.each(draw, function (k, v) {\n\t\t\tif (v !== null && o.n === v.n) {\n\t\t\t    draw[k] = null;\n\t\t\t}\n\t\t    });\n\t\t}\n\t\tthis['_' + module].redraw.apply(this);\n\t    }\n\n\t    /* block : false */\n\t    this.game.block.call(this, false, module);\n\n\t    /* action */\n\t    this.game.action.call(this, true);\n\n\t    /* return */\n\t    return true;\n\t}\n    });\n\n}();\n!function () {\n    'use strict';\n\n    var that = window._g;\n\n    var $wrap = $('#game-screen-wrap');\n\n    var _zeros = function (number, width) {\n\twidth -= number.toString().length;\n\tif (width > 0)\n\t{\n\t    return new Array(width + (/\\./.test(number) ? 2 : 1)).join('0') + number;\n\t}\n\treturn number + \"\";\n    };\n\n    var _draw = function (name) {\n\tvar that = this;\n\n\tvar img = this.game.image(name).img;\n\tvar ctx = this.game.canvas.call(this, $wrap);\n\tctx.clearRect(0, 0, that.game.size().width, that.game.size().height);\n\tctx.drawImage(img, 0, 0);\n\tthis.game.block.call(this, false, module);\n    };\n\n    var _anim = function (imgs) {\n\t/* canvas */\n\tvar ctx = this.game.canvas.apply(this, [$wrap]);\n\n\t/* draw */\n\tvar f = function () {\n\t    var img = imgs.shift();\n\t    if (img === undefined) {\n\t\tthat.game.block.call(this, false, module);\n\t\treturn;\n\t    }\n\t    ctx.clearRect(0, 0, that.game.size().width, that.game.size().height);\n\t    ctx.drawImage(img, 0, 0);\n\t    setTimeout(f, 160, imgs);\n\t};\n\tf();\n\n    };\n\n    var screens = {\n\tlanding: function () {\n\t    _draw.call(this, 'bg$screen$landing');\n\t},\n\n\tweekLater: function () {\n\t    _draw.call(this, 'bg$screen$date$weekLater');\n\t},\n\n\tshuttle: function () {\n\t    _draw.call(this, 'bg$screen$shuttle_fly');\n\t},\n\n\tprologue_start: function () {\n\t    _draw.call(this, 'bg$screen$prologue$001');\n\t},\n\n\tprologue_anim: function () {\n\t    this.game.block.call(this, true, module);\n\n\t    /* imgs */\n\t    var imgs = [];\n\t    for (var i = 2; i <= 22; i++) {\n\t\timgs.push(that.game.image('bg$screen$prologue$' + _zeros(i, 3)).img);\n\t    }\n\n\t    _anim.call(this, imgs);\n\n\t},\n\n\tday01_dawn: function () {\n\t    this.game.block.call(this, true, module);\n\t    /* imgs */\n\t    var imgs = [];\n\t    var _push = function (img) {\n\t\timgs.push(that.game.image('bg$screen$prologue$' + img).img);\n\t    };\n\n\t    for (var i = 22; i <= 29; i++) {\n\t\t_push(_zeros(i, 3));\n\t    }\n\n\t    _push('029_dawn');\n\t    _anim.call(this, imgs);\n\t}\n\n    };\n\n    /* module */\n    var module = 'screen';\n    that.module(module, {\n\thide: function () {\n\t    $wrap.empty().hide();\n\t    this.module(module).active.call(this, false);\n\t},\n\n\tactive: function (isActive) {\n\t    $wrap[isActive ? 'addClass' : 'removeClass']('active');\n\t},\n\n\tdispatch: function (act) {\n\t    this.game.block.call(this, true, module);\n\n\t    $wrap.show();\n\n\t    /* name */\n\t    var name = $.trim(act.value.replace(/^[a-z]+/i, ''));\n\n\t    if (typeof screens[name] === 'function') {\n\t\tthis._screen.active.apply(this, [true]);\n\t\tscreens[name].apply(this);\n\t    } else {\n\t\talert('Screen: ' + name);\n\t    }\n\n\t    /* return */\n\t    return true;\n\t}\n\n    });\n\n}();\n!function () {\n    'use strict';\n\n    var names = {};\n\n    var $wrap = $('#game-text-wrap');\n\n    var $text = $('#game-text');\n    var $nameWrap = $('#game-text-name-wrap');\n    var $name = $('#game-text-name');\n\n\n    /* add module */\n    var module = 'text';\n    window._g.module(module, {\n\thide: function (state) {\n\t    $wrap[state === true ? 'hide' : 'show']();\n\t},\n\n\tdispatch: function (act) {\n\n\t    /* block : true */\n\t    this.game.block.call(this, true, module);\n\n\t    /* show */\n\t    this.module(module).hide.call(this, false);\n\n\t    /* prepare */\n\t    var value = act.value.replace(/^(text|say)\\s+/, '');\n\n\t    /* if define */\n\t    var m = value.match(/^define\\s+([a-z_]+)/i);\n\n\t    if (m !== null && m.length === 2) {\n\t\t/* block : false */\n\t\tthis.game.block.call(this, false, module);\n\n\t\tnames[m[1]] = value.replace(/^define\\s+([a-z_]+)\\s+/i, '');\n\t\tthis.game.action.call(this, true);\n\t\treturn true;\n\t    }\n\n\t    /* name */\n\t    m = value.match(/^([a-z_]+)/i);\n\n\t    var isName = false;\n\t    if (m !== null) {\n\t\tisName = typeof names[m[0]] !== 'undefined';\n\t    }\n\t    var text = isName === false ? value : value.replace(/^[a-z_]+\\s+/i, '');\n\n\t    $nameWrap[isName ? 'show' : 'hide']();\n\t    $name.html(isName ? names[m[0]] : '');\n\n\t    $text.html(text);\n\n\t    /* block : false */\n\t    this.game.block.call(this, false, module);\n\n\t    /* return */\n\t    return true;\n\t}\n    });\n\n}();\n!function () {\n    'use strict';\n\n    var actions = [];\n    var actionID = -1;\n    var sun = 'day';\n    var that = window._g;\n\n    var labels = {};\n    var images = {};\n    var blocks = {};\n    var dialogs = {};\n    var dialogID = 0;\n\n    var instanceID = 0;\n\n    var isDev = that.isDev;\n\n    var $log = $('#dev_log');\n    var $dev = $('#dev_wrapper');\n    var $btnStart = $('#game-menu-btn-start');\n\n    that.game = {\n\tisBlock: function () {\n\t    var isBlock = false;\n\t    $.each(blocks, function (k, v) {\n\t\tif (v === true) {\n\t\t    isBlock = true;\n\t\t    return false;\n\t\t}\n\t    });\n\n\t    return isBlock;\n\t},\n\tblock: function (state, module) {\n\t    if (typeof module === 'undefined') {\n\t\tmodule = 'main';\n\t    }\n\t    blocks[module] = state;\n\t},\n\n\tinstance: function () {\n\t    return instanceID;\n\t},\n\tsun: function () {\n\t    return sun;\n\t},\n\n\tcanvas: function ($wrap) {\n\t    var id = $wrap.attr('id') + '-canvas';\n\t    var $canvas = $('#' + id);\n\t    if ($canvas.length === 0) {\n\t\t$('<canvas>').prependTo($wrap).attr('id', id);\n\t    }\n\n\t    var c = document.getElementById(id);\n\t    c.width = this.game.size().width;\n\t    c.height = this.game.size().height;\n\n\t    return c.getContext('2d');\n\t},\n\n\timage: function (name) {\n\n\t    /* normal */\n\t    if (typeof images[name] !== 'undefined') {\n\t\treturn images[name];\n\t    }\n\n\t    /* sun */\n\t    if (typeof images[name + '_' + sun] !== 'undefined') {\n\t\treturn images[name + '_' + sun];\n\t    }\n\n\t    return false;\n\t},\n\n\timages: function (imgs) {\n\t    images = imgs;\n\t},\n\n\tsize: function () {\n\t    return {\n\t\twidth: 1200,\n\t\theight: 800\n\t    };\n\t},\n\n\ttime: function (set) {\n\t    if (typeof set === 'undefined') {\n\t\tif (['day', 'night', 'sunset', 'dawn'].indexOf(set) >= 0) {\n\t\t    that = set;\n\t\t}\n\t    }\n\t    return sun;\n\t},\n\n\treset: function () {\n\t    /* set defaults */\n\t    blocks = {main: true};\n\t    sun = 'day';\n\t    instanceID++;\n\t    actionID = -1;\n\n\t    /* flush */\n\t    $.each(that.modules, function (k, v) {\n\t\tif (typeof that[v].flush === 'function') {\n\t\t    that[v].flush.call(that);\n\t\t}\n\t    });\n\t    \n\t    $('body').removeClass('production');\n\n\t    /* show blocks */\n\t    if (this.isDev) {\n\t\t\n\t\t$('#dev_wrapper').show();\n\t    }\n\n\t    $('#game-message').hide();\n\t    $('#game-wrapper').show();\n\t    $('#game-text-wrap').show();\n\t    $('#game-menu').show();\n\t},\n\n\tactions: function (str) {\n\t    /* split */\n\t    var story = str.split(/\\r|\\n|\\r\\n/);\n\n\t    var _log = function (str) {\n\t\t$log.prepend('<div>' + str + '</div>');\n\t    };\n\n\t    if (isDev) {\n\t\t$log.empty();\n\t\t_log('Начинаем обработку сюжета');\n\t    }\n\n\t    /* reset game state */\n\t    instanceID++;\n\t    actionID = -1;\n\t    actions = [];\n\t    labels = {};\n\t    dialogs = {};\n\t    dialogID = 0;\n\n\t    /* vars */\n\t    var stringID = 0;\n\n\t    /* message */\n\t    var $msg = $('<div>').appendTo('#game-message');\n\n\t    /* modules */\n\t    var modules = [\n\t\t'bg',\n\t\t'human',\n\t\t'screen',\n\t\t'text',\n\t\t'say',\n\t\t'label',\n\t\t'go',\n\t\t'delay',\n\t\t'shake',\n\t\t'sun'\n\t    ];\n\t    var reModule = new RegExp('^(' + modules.join('|') + ')', 'i');\n\n\t    var isComment = false;\n\n\t    var isDialog = false;\n\t    var dialog = [];\n\n\t    $.each(story, function (k, v) {\n\t\t/* message */\n\t\t$msg.html('Обработка сюжета: ' + (k + 1) + '/' + story.length);\n\n\t\t/* prepare */\n\t\tv = $.trim(v.replace(/ {1,}/g, ' '));\n\n\t\t/* string ID */\n\t\tstringID++;\n\n\t\t/* comment */\n\t\tif (/^\\/\\*/.test(v)) {\n\t\t    isComment = true;\n\t\t} else if (/\\*\\/$/.test(v)) {\n\t\t    isComment = false;\n\t\t    return true;\n\t\t}\n\n\t\t/* skip */\n\t\tif (v === '' || /^\\/\\//.test(v) || isComment) {\n\t\t    return true;\n\t\t}\n\n\t\t/* action ID */\n\t\tvar actionID = actions.length;\n\n\t\t/* dialog - start */\n\t\tif (v === 'dialog' && !isDialog) {\n\t\t    dialog = [];\n\t\t    isDialog = true;\n\t\t    return true;\n\t\t}\n\n\t\t/* dialog - add */\n\t\tif (v !== 'dialog' && isDialog) {\n\n\t\t    var m = v.match(/^([a-z_0-9]+)/i);\n\n\t\t    var d = {\n\t\t\tlabel: null,\n\t\t\tname: null\n\t\t    };\n\n\t\t    if (m !== null && m.length === 2) {\n\t\t\td.label = $.trim(m[1]);\n\n\t\t\tvar re = new RegExp('^' + m[1] + '', 'i');\n\t\t\td.name = $.trim(v.replace(re, ''));\n\n\t\t\tdialog.push(d);\n\t\t    }\n\n\t\t    return true;\n\t\t}\n\n\t\t/* dialog - end */\n\t\tif (v === 'dialog' && isDialog) {\n\t\t    var id = ++dialogID;\n\t\t    dialogs[id] = dialog;\n\t\t    isDialog = false;\n\n\t\t    /* action add */\n\t\t    actions.push({\n\t\t\tmodule: 'dialog',\n\t\t\tid: {\n\t\t\t    string: stringID,\n\t\t\t    action: actionID\n\t\t\t},\n\t\t\tvalue: id\n\t\t    });\n\n\t\t    return true;\n\t\t}\n\n\n\t\t/* module */\n\t\tvar module = v.match(reModule);\n\t\tif (module === null) {\n\t\t    module = 'text';\n\t\t} else {\n\t\t    module = module[0];\n\t\t}\n\n\t\t/* module alias */\n\t\tif (module === 'say') {\n\t\t    module = 'text';\n\t\t}\n\n\t\t/* module: label */\n\t\tif (module === 'label') {\n\t\t    var m = v.match(/^label\\s+([a-z_0-9]+)/i);\n\t\t    if (m !== null && m.length === 2) {\n\t\t\tlabels[m[1]] = actionID;\n\t\t    }\n\t\t}\n\n\t\t/* action add */\n\t\tactions.push({\n\t\t    module: module,\n\t\t    id: {\n\t\t\tstring: stringID,\n\t\t\taction: actionID\n\t\t    },\n\t\t    value: v\n\t\t});\n\n\t    });\n\n\t    /* dialogs - set */\n\t    this.module('dialog').dialogs.call(this, dialogs);\n\n\t    if (this.isDev) {\n\t\t_log('Обработка окончена');\n\t    }\n\n\t    that.game.reset.call(this);\n\t},\n\n\tlabel: function (label) {\n\t    if (typeof labels[label] !== 'undefined') {\n\t\tthis.game.action.call(this, labels[label]);\n\t    } else {\n\t\talert('Label error: ' + label);\n\t    }\n\t    return;\n\t},\n\n\taction: function (actionNext) {\n\t    var that = this;\n\n\t    /* is block */\n\t    if (this.game.isBlock()) {\n\t\treturn;\n\t    }\n\n\t    /* action ID */\n\t    if (actionNext === true) {\n\t\tactionID++;\n\t    } else if (Number.isInteger(actionNext)) {\n\t\tactionID = actionNext;\n\t    }\n\n\t    /* end game */\n\t    if (typeof actions[actionID] === 'undefined') {\n\t\talert('К сожалению дальнейшая часть игры ещё не готова :(');\n\t\tthis.game.reset.call(this);\n\t\treturn;\n\t    }\n\n\t    var act = actions[actionID];\n\n\t    if (isDev) {\n\t\t$('<div>')\n\t\t\t.prependTo('#dev_log')\n\t\t\t.html('Строка <b>' + act.id.string + '</b>: ' + act.value);\n\n\t    }\n\n\t    /* label|go|delay|shake|sun */\n\t    if (act.module === 'label') {\n\t\tthis.game.action.call(this, true);\n\t\treturn;\n\t    } else if (act.module === 'go') {\n\t\t/* go */\n\t\tthis.game.label.call(this, act.value.replace(/^go\\s+/, ''));\n\t    } else if (act.module === 'delay') {\n\t\tvar d = parseFloat(act.value.replace(/^delay/, ''));\n\t\tthis.game.block.call(this, true);\n\n\t\tsetTimeout(function () {\n\t\t    that.game.block.call(this, false);\n\t\t    that.game.action.call(that, true);\n\t\t}, d * 1000);\n\t\treturn;\n\t    } else if (act.module === 'shake') {\n\t\tthis.game.block.call(this, true);\n\t\t$('body').css('overflow', 'hidden');\n\t\t$('#game-wrapper').effect(\"shake\", {direction: 'left', distance: 20, times: 2}, 200, function () {\n\t\t    that.game.block.call(this, false);\n\t\t    $('body').removeAttr('style');\n\t\t    that.game.action.call(that, true);\n\t\t});\n\t    } else if (act.module === 'sun') {\n\t\tvar val = $.trim(act.value.replace(/^sun/, ''));\n\n\t\tif ($.inArray(val, ['day', 'night', 'dawn', 'sunset']) >= 0) {\n\t\t    sun = val;\n\t\t}\n\n\t\tthis.game.action.call(this, true);\n\t\treturn;\n\t    }\n\n\t    /* module */\n\t    var name = '_' + act.module;\n\n\t    /* screen fix */\n\t    if (act.module !== 'screen') {\n\t\tthis.module('screen').hide.call(this);\n\t    }\n\n\t    /* action */\n\t    if (typeof this[name] !== 'undefined' && typeof this[name]['dispatch'] === 'function') {\n\t\tvar response = this[name].dispatch.apply(this, [act]);\n\t\tif (response !== true) {\n\t\t    console.warn(response, act);\n\t\t    this.game.block.call(this, true);\n\t\t}\n\t\treturn;\n\t    }\n\t},\n\n\tpreload: function () {\n\t    var $message = $('#game-message');\n\t    var game = this.game;\n\t    var that = this;\n\n\t    /* start */\n\t    $btnStart\n\t\t    .on('click', function (e) {\n\t\t\tgame.reset.call(that);\n\t\t\tblocks = {};\n\t\t\tgame.action.call(that, true);\n\n\t\t\t$('#game-menu').hide();\n\t\t\treturn false;\n\t\t    });\n\n\t    /* dev help */\n\t    $dev\n\t\t    .on('click', function (e) {\n\t\t\tvar $btn = $(e.target).closest('.game-dev-demo-btn');\n\t\t\tif ($btn.length > 0) {\n\t\t\t    var $btns = $dev.find('input,button').prop('disabled', true);\n\n\t\t\t    $.get($btn.data('href'), function (str) {\n\t\t\t\t$btns.prop('disabled', false);\n\t\t\t\tgame.actions.call(that, str);\n\t\t\t\t$btnStart.trigger('click');\n\t\t\t\t$('html,body')\n\t\t\t\t\t.animate({\n\t\t\t\t\t    scrollTop: 0\n\t\t\t\t\t}, 600);\n\t\t\t    });\n\n\t\t\t}\n\n\t\t    });\n\n\n\t    /* action */\n\t    $('#game')\n\t\t    .on('click', function () {\n\t\t\tgame.action.call(that, true);\n\t\t    });\n\n\t    /* key - space */\n\t    $(window)\n\t\t    .keydown(function (e) {\n\t\t\tif (e.keyCode === 32) {\n\t\t\t    game.action.call(that, true);\n\t\t\t    return false;\n\t\t\t}\n\t\t    });\n\n\t    /* mouse on */\n\t    var mouseInterval;\n\t    var mouseTimeout;\n\t    $(window)\n\t\t    .on('mousedown', function () {\n\t\t\tmouseTimeout = setTimeout(function () {\n\t\t\t    mouseInterval = setInterval(function () {\n\t\t\t\tgame.action.call(that, true);\n\t\t\t    }, 100);\n\t\t\t}, 1000);\n\t\t    })\n\t\t    .on('mouseup', function () {\n\t\t\tclearTimeout(mouseTimeout);\n\t\t\tclearInterval(mouseInterval);\n\t\t    });\n\n\t    /* dev */\n\t    if (this.isDev) {\n\t\t/* play */\n\t\t$('#dev_file-btn')\n\t\t\t.on('click', function () {\n\n\t\t\t    if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {\n\t\t\t\talert('Ваш браузер не поддерживает FileAPI');\n\t\t\t\treturn;\n\t\t\t    }\n\n\t\t\t    var input = document.getElementById('dev_file');\n\t\t\t    if (!input.files) {\n\t\t\t\talert(\"Ваш браузер не поддерживает .files\");\n\t\t\t    } else if (!input.files[0]) {\n\t\t\t\talert(\"Файл не выбран\");\n\t\t\t    } else {\n\t\t\t\tvar file = input.files[0];\n\t\t\t\tvar fr = new FileReader();\n\t\t\t\tfr.onload = function () {\n\t\t\t\t    var str = fr.result;\n\t\t\t\t    alert('Файл загружен, можете начать новую игру.');\n\t\t\t\t    $('html,body').scrollTop(0);\n\t\t\t\t    game.actions.call(that, str);\n\t\t\t\t};\n\t\t\t\tfr.readAsText(file, \"windows-1251\");\n\t\t\t    }\n\t\t\t});\n\n\t    }\n\n\t    var $imageLoading = $('#image-loading');\n\t    var _imageCache = function () {\n\n\t\tvar $images = $imageLoading.children('img');\n\t\tvar loaded = 0;\n\t\tvar count = $images.length;\n\t\tvar imgs = {};\n\n\t\t$images.each(function (k, v) {\n\t\t    var img = new Image();\n\t\t    var name = $(this).data('name');\n\t\t    var src = $(this).attr('src');\n\n\t\t    img.onload = function () {\n\t\t\tloaded++;\n\t\t\timgs[name] = {\n\t\t\t    img: this,\n\t\t\t    src: src,\n\t\t\t    width: this.width,\n\t\t\t    height: this.height\n\t\t\t};\n\t\t\tif (loaded === count) {\n\t\t\t    that.game.images(imgs);\n\t\t\t    $('<div>')\n\t\t\t\t    .appendTo($message)\n\t\t\t\t    .html('Загрузка сюжета');\n\n\t\t\t    $\n\t\t\t\t    .get(that.domain + '/story.txt?v=' + new Date().getTime(), function (str) {\n\t\t\t\t\tgame.actions.call(that, str);\n\n\t\t\t\t\t/* test */\n\t\t\t\t\tif (0) {\n\t\t\t\t\t    $btnStart.trigger('click');\n\t\t\t\t\t}\n\t\t\t\t    })\n\t\t\t\t    .fail(function () {\n\t\t\t\t\talert('Не удалось загрузить сюжет. Страница будет обновлена.');\n\t\t\t\t\twindow.location.reload(true);\n\t\t\t\t    });\n\t\t\t}\n\t\t    };\n\t\t    img.src = src;\n\t\t});\n\t    };\n\n\t    /* image loading */\n\t    $imageLoading\n\t\t    .imagesLoaded()\n\t\t    .done(function (instance) {\n\t\t\t_imageCache();\n\t\t    })\n\t\t    .fail(function () {\n\t\t\talert('Не все изображения были загружены. Страница будет обновлена');\n\t\t\twindow.location.reload(true);\n\t\t    })\n\t\t    .progress(function (instance, image) {\n\t\t\tvar c = parseInt(that.imageCount);\n\t\t\t$message.html('Загрузка изображений: ' + instance.progressedCount + '/' + c);\n\t\t\tif (!image.isLoaded) {\n\t\t\t    console.warn(image);\n\t\t\t}\n\t\t    });\n\t}\n    };\n\n    /* start game */\n    that.game.preload.call(that);\n\n}();\n"]}